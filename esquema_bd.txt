CREATE TABLE sucursales (
	id INTEGER NOT NULL, 
	nombre VARCHAR(100) NOT NULL, 
	direccion TEXT, 
	telefono VARCHAR(20), 
	activa BOOLEAN, 
	PRIMARY KEY (id)
)\nCREATE TABLE categorias (
	id INTEGER NOT NULL, 
	nombre VARCHAR(100) NOT NULL, 
	PRIMARY KEY (id)
)\nCREATE TABLE productos (
	id INTEGER NOT NULL, 
	nombre VARCHAR(100) NOT NULL, 
	descripcion TEXT, 
	categoria_id INTEGER NOT NULL, 
	stock_actual INTEGER, 
	stock_minimo INTEGER, 
	precio_venta FLOAT NOT NULL, 
	codigo_barras VARCHAR(50), 
	activo BOOLEAN, 
	vida_util_dias INTEGER, 
	es_pan BOOLEAN, 
	fecha_creacion DATETIME, 
	tipo_producto VARCHAR(20), 
	costo_compra FLOAT, 
	proveedor_externo VARCHAR(100), 
	receta_id INTEGER, 
	PRIMARY KEY (id), 
	FOREIGN KEY(categoria_id) REFERENCES categorias (id), 
	UNIQUE (codigo_barras), 
	FOREIGN KEY(receta_id) REFERENCES recetas (id)
)\nCREATE TABLE proveedor (
	id INTEGER NOT NULL, 
	nombre VARCHAR(100) NOT NULL, 
	contacto VARCHAR(100), 
	telefono VARCHAR(20), 
	email VARCHAR(100), 
	direccion TEXT, 
	productos_que_suministra TEXT, 
	tiempo_entrega_dias INTEGER, 
	evaluacion INTEGER, 
	activo BOOLEAN, 
	fecha_registro DATETIME, 
	PRIMARY KEY (id)
)\nCREATE TABLE recetas (
	id INTEGER NOT NULL, 
	nombre VARCHAR(255) NOT NULL, 
	descripcion TEXT, 
	categoria VARCHAR(100), 
	peso_unidad_gramos FLOAT NOT NULL, 
	porcentaje_perdida FLOAT, 
	costo_total FLOAT, 
	precio_venta FLOAT, 
	activo BOOLEAN, 
	created_at DATETIME, 
	precio_venta_real FLOAT, 
	precio_venta_unitario FLOAT, 
	precio_por_gramo FLOAT, 
	peso_total_masa FLOAT, 
	unidades_obtenidas INTEGER, 
	peso_horneado_unidad FLOAT, 
	costo_materias_primas FLOAT, 
	costo_indirecto FLOAT, 
	margen_ganancia FLOAT, 
	producto_id INTEGER, 
	PRIMARY KEY (id), 
	FOREIGN KEY(producto_id) REFERENCES productos (id)
)\nCREATE TABLE clientes (
	id INTEGER NOT NULL, 
	documento VARCHAR(20) NOT NULL, 
	nombre VARCHAR(200) NOT NULL, 
	tipo_documento VARCHAR(2), 
	tipo_persona VARCHAR(1), 
	direccion TEXT, 
	telefono VARCHAR(20), 
	email VARCHAR(100), 
	ciudad VARCHAR(100), 
	departamento VARCHAR(100), 
	regimen VARCHAR(50), 
	responsabilidades TEXT, 
	activo BOOLEAN, 
	fecha_registro DATETIME, 
	fecha_actualizacion DATETIME, 
	PRIMARY KEY (id)
)\nCREATE TABLE gastos (
	id INTEGER NOT NULL, 
	fecha DATETIME, 
	descripcion VARCHAR(200) NOT NULL, 
	categoria VARCHAR(50) NOT NULL, 
	monto FLOAT NOT NULL, 
	PRIMARY KEY (id)
)\nCREATE TABLE jornadas_ventas (
	id INTEGER NOT NULL, 
	fecha DATE NOT NULL, 
	estado VARCHAR(20), 
	total_ventas FLOAT, 
	total_efectivo FLOAT, 
	total_transferencia FLOAT, 
	total_tarjeta FLOAT, 
	created_at DATETIME, 
	cerrada_at DATETIME, 
	PRIMARY KEY (id), 
	UNIQUE (fecha)
)\nCREATE TABLE registros_diarios (
	id INTEGER NOT NULL, 
	fecha DATE NOT NULL, 
	venta_total FLOAT, 
	efectivo FLOAT, 
	transferencias FLOAT, 
	tarjetas FLOAT, 
	gasto_proveedores FLOAT, 
	gasto_servicios FLOAT, 
	gasto_nomina FLOAT, 
	gasto_alquiler FLOAT, 
	gasto_otros FLOAT, 
	descripcion_gastos VARCHAR(300), 
	numero_factura VARCHAR(100), 
	total_ingresos FLOAT, 
	total_egresos FLOAT, 
	saldo_dia FLOAT, 
	fecha_creacion DATETIME, 
	PRIMARY KEY (id)
)\nCREATE TABLE saldos_banco (
	id INTEGER NOT NULL, 
	fecha_actualizacion DATETIME, 
	saldo_actual FLOAT, 
	comentario VARCHAR(200), 
	PRIMARY KEY (id)
)\nCREATE TABLE activos_fijos (
	id INTEGER NOT NULL, 
	nombre VARCHAR(200) NOT NULL, 
	categoria VARCHAR(100) NOT NULL, 
	descripcion TEXT, 
	numero_serie VARCHAR(100), 
	fecha_compra DATE NOT NULL, 
	proveedor VARCHAR(200), 
	valor_compra FLOAT NOT NULL, 
	metodo_pago VARCHAR(100), 
	vida_util INTEGER, 
	valor_residual FLOAT, 
	metodo_depreciacion VARCHAR(50), 
	ubicacion VARCHAR(200), 
	estado VARCHAR(50), 
	responsable VARCHAR(200), 
	fecha_registro DATETIME, 
	fecha_baja DATE, 
	PRIMARY KEY (id)
)\nCREATE TABLE consecutivos_pos (
	id INTEGER NOT NULL, 
	numero_actual INTEGER, 
	updated_at DATETIME, 
	PRIMARY KEY (id)
)\nCREATE TABLE configuracion_sistema (
	id INTEGER NOT NULL, 
	tipo_facturacion VARCHAR(20), 
	nombre_empresa VARCHAR(200), 
	nit_empresa VARCHAR(20), 
	direccion_empresa VARCHAR(300), 
	telefono_empresa VARCHAR(20), 
	ciudad_empresa VARCHAR(100), 
	regimen_empresa VARCHAR(100), 
	created_at DATETIME, 
	PRIMARY KEY (id)
)\nCREATE TABLE usuarios (
	id INTEGER NOT NULL, 
	username VARCHAR(80) NOT NULL, 
	password_hash VARCHAR(200) NOT NULL, 
	nombre_completo VARCHAR(100) NOT NULL, 
	email VARCHAR(120), 
	telefono VARCHAR(20), 
	rol VARCHAR(20), 
	activo BOOLEAN, 
	fecha_creacion DATETIME, 
	fecha_ultimo_acceso DATETIME, 
	sucursal_id INTEGER, 
	PRIMARY KEY (id), 
	UNIQUE (username), 
	FOREIGN KEY(sucursal_id) REFERENCES sucursales (id)
)\nCREATE TABLE productos_externos (
	id INTEGER NOT NULL, 
	codigo_barras VARCHAR(100), 
	nombre VARCHAR(200) NOT NULL, 
	descripcion TEXT, 
	categoria VARCHAR(100) NOT NULL, 
	marca VARCHAR(100), 
	proveedor_id INTEGER, 
	stock_actual INTEGER, 
	stock_minimo INTEGER, 
	precio_compra FLOAT NOT NULL, 
	precio_venta FLOAT NOT NULL, 
	total_ventas INTEGER, 
	total_ingresos FLOAT, 
	utilidad_total FLOAT, 
	activo BOOLEAN, 
	fecha_creacion DATETIME, 
	fecha_ultima_compra DATETIME, 
	fecha_ultima_venta DATETIME, 
	PRIMARY KEY (id), 
	UNIQUE (codigo_barras), 
	FOREIGN KEY(proveedor_id) REFERENCES proveedor (id)
)\nCREATE TABLE materias_primas (
	id INTEGER NOT NULL, 
	nombre VARCHAR(100) NOT NULL, 
	proveedor_id INTEGER NOT NULL, 
	unidad_medida VARCHAR(20) NOT NULL, 
	costo_promedio FLOAT, 
	stock_actual FLOAT, 
	stock_minimo FLOAT, 
	fecha_ultima_actualizacion DATETIME, 
	fecha_vencimiento DATE, 
	activo BOOLEAN, 
	unidad_compra VARCHAR(50), 
	gramos_por_empaque FLOAT, 
	stock_minimo_empaques INTEGER, 
	PRIMARY KEY (id), 
	FOREIGN KEY(proveedor_id) REFERENCES proveedor (id)
)\nCREATE TABLE stock_productos (
	id INTEGER NOT NULL, 
	receta_id INTEGER NOT NULL, 
	stock_actual INTEGER, 
	stock_minimo INTEGER, 
	fecha_actualizacion DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(receta_id) REFERENCES recetas (id)
)\nCREATE TABLE configuracion_produccion (
	id INTEGER NOT NULL, 
	receta_id INTEGER NOT NULL, 
	stock_objetivo INTEGER, 
	stock_minimo INTEGER, 
	stock_maximo INTEGER, 
	porcentaje_critico FLOAT, 
	porcentaje_bajo FLOAT, 
	porcentaje_medio FLOAT, 
	tendencia_ventas FLOAT, 
	rotacion_diaria_esperada FLOAT, 
	activo BOOLEAN, 
	fecha_actualizacion DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(receta_id) REFERENCES recetas (id)
)\nCREATE TABLE historial_rotacion_producto (
	id INTEGER NOT NULL, 
	producto_id INTEGER NOT NULL, 
	fecha DATE NOT NULL, 
	ventas_dia INTEGER, 
	rotacion_real FLOAT, 
	tendencia_semanal FLOAT, 
	PRIMARY KEY (id), 
	CONSTRAINT unique_rotacion_diaria UNIQUE (producto_id, fecha), 
	FOREIGN KEY(producto_id) REFERENCES productos (id)
)\nCREATE TABLE control_vida_util (
	id INTEGER NOT NULL, 
	producto_id INTEGER NOT NULL, 
	fecha_produccion DATE NOT NULL, 
	stock_inicial INTEGER NOT NULL, 
	stock_actual INTEGER NOT NULL, 
	dias_sin_rotacion INTEGER, 
	estado VARCHAR(20), 
	PRIMARY KEY (id), 
	FOREIGN KEY(producto_id) REFERENCES productos (id)
)\nCREATE TABLE cierres_diarios (
	id INTEGER NOT NULL, 
	fecha DATE NOT NULL, 
	jornada_id INTEGER, 
	total_ventas FLOAT NOT NULL, 
	total_efectivo FLOAT NOT NULL, 
	total_transferencia FLOAT NOT NULL, 
	total_tarjeta FLOAT NOT NULL, 
	total_transacciones INTEGER NOT NULL, 
	productos_top TEXT, 
	ventas_dia_anterior FLOAT, 
	tendencia FLOAT, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	UNIQUE (fecha), 
	FOREIGN KEY(jornada_id) REFERENCES jornadas_ventas (id)
)\nCREATE TABLE pagos_individuales (
	id INTEGER NOT NULL, 
	fecha_registro DATETIME, 
	fecha_pago DATE NOT NULL, 
	categoria VARCHAR(50) NOT NULL, 
	proveedor_id INTEGER, 
	monto FLOAT NOT NULL, 
	referencia VARCHAR(100), 
	descripcion VARCHAR(300), 
	numero_factura VARCHAR(100), 
	PRIMARY KEY (id), 
	FOREIGN KEY(proveedor_id) REFERENCES proveedor (id)
)\nCREATE TABLE compras_externas (
	id INTEGER NOT NULL, 
	proveedor_id INTEGER, 
	producto_id INTEGER, 
	cantidad INTEGER NOT NULL, 
	precio_compra FLOAT NOT NULL, 
	total_compra FLOAT NOT NULL, 
	fecha_compra DATETIME, 
	notas TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(proveedor_id) REFERENCES proveedor (id), 
	FOREIGN KEY(producto_id) REFERENCES productos_externos (id)
)\nCREATE TABLE historial_compras (
	id INTEGER NOT NULL, 
	materia_prima_id INTEGER NOT NULL, 
	fecha_compra DATETIME, 
	cantidad_empaques INTEGER NOT NULL, 
	precio_total FLOAT NOT NULL, 
	precio_unitario_empaque FLOAT NOT NULL, 
	usuario_id INTEGER NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(materia_prima_id) REFERENCES materias_primas (id), 
	FOREIGN KEY(usuario_id) REFERENCES usuarios (id)
)\nCREATE TABLE ventas (
	id INTEGER NOT NULL, 
	fecha_hora DATETIME, 
	total FLOAT NOT NULL, 
	metodo_pago VARCHAR(20) NOT NULL, 
	usuario_id INTEGER NOT NULL, 
	cliente_id INTEGER, 
	tipo_documento VARCHAR(20), 
	consecutivo_pos INTEGER, 
	cufe VARCHAR(100), 
	estado_dian VARCHAR(50), 
	qr_factura TEXT, 
	respuesta_dian TEXT, 
	texto_legal TEXT, 
	es_donacion BOOLEAN, 
	motivo_donacion VARCHAR(200), 
	PRIMARY KEY (id), 
	FOREIGN KEY(usuario_id) REFERENCES usuarios (id), 
	FOREIGN KEY(cliente_id) REFERENCES clientes (id)
)\nCREATE TABLE compras (
	id INTEGER NOT NULL, 
	fecha DATETIME, 
	proveedor VARCHAR(200) NOT NULL, 
	total FLOAT NOT NULL, 
	usuario_id INTEGER NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(usuario_id) REFERENCES usuarios (id)
)\nCREATE TABLE receta_ingredientes (
	id INTEGER NOT NULL, 
	receta_id INTEGER NOT NULL, 
	materia_prima_id INTEGER NOT NULL, 
	porcentaje_aplicado FLOAT NOT NULL, 
	cantidad_gramos FLOAT NOT NULL, 
	costo_ingrediente FLOAT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(receta_id) REFERENCES recetas (id), 
	FOREIGN KEY(materia_prima_id) REFERENCES materias_primas (id)
)\nCREATE TABLE ordenes_produccion (
	id INTEGER NOT NULL, 
	receta_id INTEGER NOT NULL, 
	cantidad_producir INTEGER NOT NULL, 
	fecha_produccion DATETIME, 
	estado VARCHAR(20), 
	usuario_id INTEGER NOT NULL, 
	fecha_inicio DATETIME, 
	fecha_fin DATETIME, 
	observaciones TEXT, 
	costo_real FLOAT, 
	stock_generado BOOLEAN, 
	PRIMARY KEY (id), 
	FOREIGN KEY(receta_id) REFERENCES recetas (id), 
	FOREIGN KEY(usuario_id) REFERENCES usuarios (id)
)\nCREATE TABLE permisos_usuario (
	id INTEGER NOT NULL, 
	usuario_id INTEGER NOT NULL, 
	modulo VARCHAR(50) NOT NULL, 
	accion VARCHAR(50) NOT NULL, 
	permitido BOOLEAN, 
	fecha_creacion DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(usuario_id) REFERENCES usuarios (id)
)\nCREATE TABLE detalle_venta (
	id INTEGER NOT NULL, 
	venta_id INTEGER NOT NULL, 
	producto_id INTEGER, 
	producto_externo_id INTEGER, 
	cantidad INTEGER NOT NULL, 
	precio_unitario FLOAT NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(venta_id) REFERENCES ventas (id), 
	FOREIGN KEY(producto_id) REFERENCES productos (id), 
	FOREIGN KEY(producto_externo_id) REFERENCES productos_externos (id)
)\nCREATE TABLE detalle_compras (
	id INTEGER NOT NULL, 
	compra_id INTEGER NOT NULL, 
	materia_prima_id INTEGER NOT NULL, 
	cantidad FLOAT NOT NULL, 
	precio_unitario FLOAT NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(compra_id) REFERENCES compras (id), 
	FOREIGN KEY(materia_prima_id) REFERENCES materias_primas (id)
)\nCREATE TABLE historial_inventario (
	id INTEGER NOT NULL, 
	materia_prima_id INTEGER NOT NULL, 
	orden_produccion_id INTEGER NOT NULL, 
	cantidad_utilizada FLOAT NOT NULL, 
	fecha_movimiento DATETIME, 
	tipo_movimiento VARCHAR(20), 
	PRIMARY KEY (id), 
	FOREIGN KEY(materia_prima_id) REFERENCES materias_primas (id), 
	FOREIGN KEY(orden_produccion_id) REFERENCES ordenes_produccion (id)
)\nCREATE TABLE facturas (
	id INTEGER NOT NULL, 
	venta_id INTEGER NOT NULL, 
	numero_factura VARCHAR(50) NOT NULL, 
	fecha_emision DATETIME, 
	subtotal FLOAT NOT NULL, 
	iva FLOAT, 
	total FLOAT NOT NULL, 
	nombre_panaderia VARCHAR(200), 
	nit_panaderia VARCHAR(50), 
	direccion_panaderia TEXT, 
	telefono_panaderia VARCHAR(20), 
	PRIMARY KEY (id), 
	FOREIGN KEY(venta_id) REFERENCES ventas (id), 
	UNIQUE (numero_factura)
)